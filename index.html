<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="ZxPiano">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ZxPiano">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="ZxPiano">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>ZxPiano</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ZxPiano</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/14/advertisementBoard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/14/advertisementBoard/" class="post-title-link" itemprop="url">广告牌</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-14 16:30:00 / Modified: 16:30:22" itemprop="dateCreated datePublished" datetime="2020-11-14T16:30:00+08:00">2020-11-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="广告牌"><a href="#广告牌" class="headerlink" title="广告牌"></a>广告牌</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/08/PBR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/08/PBR/" class="post-title-link" itemprop="url">PBR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-08 17:17:00 / Modified: 17:17:51" itemprop="dateCreated datePublished" datetime="2020-11-08T17:17:00+08:00">2020-11-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="PBR"><a href="#PBR" class="headerlink" title="PBR"></a>PBR</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/08/SSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/08/SSS/" class="post-title-link" itemprop="url">SSS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-08 17:16:00 / Modified: 17:17:25" itemprop="dateCreated datePublished" datetime="2020-11-08T17:16:00+08:00">2020-11-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SSS"><a href="#SSS" class="headerlink" title="SSS"></a>SSS</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/07/URP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/07/URP/" class="post-title-link" itemprop="url">Unity URP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-07 18:03:00" itemprop="dateCreated datePublished" datetime="2020-11-07T18:03:00+08:00">2020-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-21 17:01:14" itemprop="dateModified" datetime="2020-11-21T17:01:14+08:00">2020-11-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="URP"><a href="#URP" class="headerlink" title="URP"></a>URP</h2><h3 id="RenderPipelineAsset"><a href="#RenderPipelineAsset" class="headerlink" title="RenderPipelineAsset"></a>RenderPipelineAsset</h3><p>首先必须为管线创建资产，继承UnityEngine.Rendering空间下的CustomRenderPipelineAsset</p>
<p>RP资产的主要目的是为Unity提供一种获取负责渲染的管道对象实例的方式。资产本身只是一个句柄和一个存储设置的地方。</p>
<p>添加[CreateAssetMenu(menuName = “Rendering/Custom Render Pipeline”)]，可以从unity的create中创建</p>
<h3 id="RenderPipeline"><a href="#RenderPipeline" class="headerlink" title="RenderPipeline"></a>RenderPipeline</h3><p>其次需要一个管线类，继承 RenderPipeline</p>
<p>重写Render创建具体的管线</p>
<p>ScriptableRenderContext 贯穿始终</p>
<h3 id="渲染相机"><a href="#渲染相机" class="headerlink" title="渲染相机"></a>渲染相机</h3><p>Context的命令只是缓冲，需要提交才会执行</p>
<p>commandBuffer 执行命令进行两次，设置时执行一次，提交前执行一次（此处的执行是一个命令，但并未真的执行，在提交后才会执行）</p>
<p>Draw GL 项代表绘制一个全屏幕的使用Hidden/InternalClear Shader的quad 到渲染目标，先设置相机属性，在清理渲染目标，可以快速清理。</p>
<p>多相机，每帧渲染一台以上的摄像机意味着必须同时进行多次剔除，设置，分类等操作</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/11/depth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/depth/" class="post-title-link" itemprop="url">深度 / depth / Z</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-11 22:45:00" itemprop="dateCreated datePublished" datetime="2020-10-11T22:45:00+08:00">2020-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-14 16:20:35" itemprop="dateModified" datetime="2020-11-14T16:20:35+08:00">2020-11-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="深度"><a href="#深度" class="headerlink" title="深度"></a>深度</h2><p>Unity中，透视投影，观察空间变换到裁剪空间后，深度值会变成非线性的。计算过程如下。</p>
<script type="math/tex; mode=display">{z}' = -z\frac{(F+N)}{F-N} - \frac{2\cdot N\cdot F}{F-N}</script><p>其中${z}’$为裁剪空间的深度值，$z$为观察空间的深度值，$F$为远裁剪面，$N$为近裁剪面。</p>
<p>裁剪空间到屏幕空间会进行一次透视除法，再做一次缩放平移，所以在计算中最终会用到的clipPos.z（片段着色器中）最终为：</p>
<script type="math/tex; mode=display">clipZ = (\frac{(F+N)}{F-N} - \frac{2\cdot N\cdot F}{(F-N)\cdot z})\cdot 0.5 + 0.5</script><p>取《Shader入门精要》的案例，F=40，N=5<br>如图，紫线为最终结果，可以看到clipZ是非线性的，值域在（0，1）。横轴为观察空间Z值，为负数；纵轴为屏幕空间Z值</p>
<p><img src="/images/depth/depth0.jpg" alt=""></p>
<hr>
<p>Unity Shader的计算中，涉及到深度的计算，通常会用到<strong>LinearEyeDepth</strong>和<strong>Linear01Depth</strong>，<strong>LinearEyeDepth</strong>的计算为：</p>
<script type="math/tex; mode=display">z = \frac{1}{\frac{1-\frac{F}{N}}{F}\cdot z+\frac{\frac{F}{N}}{F}}</script><p>开启UNITY_REVERSED_Z时（UNITY_REVERSED_Z表示$z = 1-z$,用于调和float的存储精度以及非线性的z值分布，使存储的z值更精确，减轻z-fightingh问题），计算方式为：</p>
<script type="math/tex; mode=display">z = \frac{1}{\frac{-1+\frac{F}{N}}{F}\cdot z+\frac{1}{F}}</script><p>两者实际效果是一样的，区别在于输入的$z$是不是反转的。</p>
<p>如图，蓝线为最终结果，输入为紫线的值，可以看到<strong>LinearEyeDepth</strong>将紫线变为线性的，并且值域为（$N$，$F$）,深度0的位置在相机位置。</p>
<p><img src="/images/depth/depth1.png" alt=""></p>
<hr>
<p><strong>Linear01Depth</strong>的计算为：</p>
<script type="math/tex; mode=display">z = \frac{1}{({1-\frac{F}{N}})\cdot z + \frac{F}{N}}</script><p>开启UNITY_REVERSED_Z时，计算方式为：</p>
<script type="math/tex; mode=display">z = \frac{1}{({-1+\frac{F}{N}})\cdot z + 1}</script><p>两者实际效果是一样的，区别在于输入的$z$是不是反转的。</p>
<p>如图，绿线为最终结果，输入为紫线的值，可以看到<strong>Linear01Depth</strong>将紫线变为线性的，并且值域为（0.125，1），深度0的位置在相机位置。</p>
<p><img src="/images/depth/depth2.png" alt=""></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>《Unity Shader入门精要》 冯乐乐</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/23/SurfaceCurveFunc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/23/SurfaceCurveFunc/" class="post-title-link" itemprop="url">曲面/曲线 方程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-23 20:50:58" itemprop="dateCreated datePublished" datetime="2020-04-23T20:50:58+08:00">2020-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 22:47:25" itemprop="dateModified" datetime="2020-10-11T22:47:25+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="曲面"><a href="#曲面" class="headerlink" title="曲面"></a>曲面</h2><h3 id="球面"><a href="#球面" class="headerlink" title="球面"></a>球面</h3><script type="math/tex; mode=display">(x-x0)^{2}+(y-y0)^{2}+(z-z0)^{2}=r^{2}\cdots (1-1)</script><p>其中\((x0,y0,z0)\)为球心位置，\(r\)为半径</p>
<h3 id="平面-圆面"><a href="#平面-圆面" class="headerlink" title="平面/圆面"></a>平面/圆面</h3><p>平面法线\(\overrightarrow{n}\)，则平面方程：</p>
<script type="math/tex; mode=display">((x-x0),(y-y0),(z-z0))\cdot \overrightarrow{n}=0\cdots (1-2)</script><p>联合(1-1)(1-2)式可得空间任意一圆圈方程，限定球面小于等于\(r^{2}\)则为圆面方程</p>
<h3 id="锥面"><a href="#锥面" class="headerlink" title="锥面"></a>锥面</h3><script type="math/tex; mode=display">\frac{(x-x0)(x1-x0)+(y-y0)(y1-y0)+(z-z0)(z1-z0)}{\sqrt{(x1-x0)^{2}+(y1-y0)^{2}+(z1-z0)^{2}}\times \sqrt{(x-x0)^{2}+(y-y0)^{2}+(z-z0)^{2}}}=cos(\alpha )</script><p>其中\((x0,y0,z0)\)为圆锥顶点，\((x1,y1,z1)\)为圆锥底面圆心顶点，\(\alpha \)为圆锥张角一半</p>
<h2 id="曲线"><a href="#曲线" class="headerlink" title="曲线"></a>曲线</h2><h3 id="直线-两点式"><a href="#直线-两点式" class="headerlink" title="直线 两点式"></a>直线 两点式</h3><script type="math/tex; mode=display">\frac{x-xa}{xb-xa}=\frac{y-ya}{yb-ya}=\frac{z-za}{zb-za}</script><p>其中\((xa,ya,za)\)，\((xb,yb,zb)\)为直线上两点\(A,B\)</p>
<h3 id="直线-参数式"><a href="#直线-参数式" class="headerlink" title="直线 参数式"></a>直线 参数式</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/23/volumetricLight/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/23/volumetricLight/" class="post-title-link" itemprop="url">体积光</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-23 20:50:58" itemprop="dateCreated datePublished" datetime="2020-04-23T20:50:58+08:00">2020-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-21 23:49:17" itemprop="dateModified" datetime="2020-11-21T23:49:17+08:00">2020-11-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="体积光"><a href="#体积光" class="headerlink" title="体积光"></a>体积光</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>体积光是空气中介质对光进行散射所形成的一种现象。散射可分为瑞利散射和米氏散射，瑞利散射针对介质颗粒大小远小于光波长的情况，米氏散射针对介质颗粒大小接近光波长的情况。</p>
<p><img src="https://tvax3.sinaimg.cn/large/bd728842gy1gkx84pj7gij20m60gmgqa.jpg" alt=""><br>图1</p>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p>以观察到的物体表面一点为起点，观察位置点为终点做一个射线，则物体表面到观察位置这之间就有一个体积，针对物体表面每一点到观察位置的射线，计算射线上每一点处介质散射出的光强然后累加，最终可以的到该物体与观察位置之间这块体积产生的体积光</p>
<p><img src="https://tvax1.sinaimg.cn/large/bd728842gy1gkx84ttmdnj20cn085mxo.jpg" alt=""><br>图2</p>
<p>如图2所示，O点为物体表面一点，C点为观察位置点，计算OC连线上每一点的介质散射出的光强并累加则为OC上的体积光。</p>
<p>OC连线上每一点P处的光强与该点到光源的距离平方成反比，即</p>
<script type="math/tex; mode=display">dL=\frac{L}{\left |PA  \right |^{2}}</script><p>其中\(A\)点为光源位置，\(\left |PA  \right |\)为\(P\)点到光源的距离，\(L\)为光源发出的光强。</p>
<p>考虑到米氏散射，入射到\(P\)点处的光强与从\(P\)点向观察位置出射的光强应服从米氏散射：</p>
<script type="math/tex; mode=display">\rho Mie=\frac{1-g^{2}}{4\pi (1+g^{2}-2gcos\theta )^{3/2}}</script><p>其中\(g\)为介质的散射特性，\(\theta\)为\(P\)点光照的入射方向与出射方向的夹角。</p>
<p>如果体积光有一定范围，则累加光强的实际有效距离为\(O’A’\)，因此需要知道P点是否处在体积光照明的范围内，以圆锥体积光为例，可以通过判断\(∠PAA’\)是否小于\(∠O’AA’\)即圆锥张角的一半。</p>
<script type="math/tex; mode=display">IsInLight = step(cos(\alpha) ,cos(\angle PAA'))</script><p>再细腻一点可以考虑到介质的透光率，即介质吸收光照与透过光照的比率，采用Beer–Lambert定律：</p>
<script type="math/tex; mode=display">Iout = Iin\times exp(-c\times d)</script><p>其中\(Iin\)为光入射到介质的光强，\(Iout\)为光通过介质后的光强，\(c\)为介质的密度，\(d\)为光穿过介质的厚度。</p>
<p>再考虑到阴影，还需要判断\(P\)点是否处于阴影当中。通过制作体积光源处的阴影贴图，再比较\(P\)点转到体积光源的透视空间后其深度是否大于阴影贴图对应位置的深度来判断\(P\)点是否位于阴影中。</p>
<p><img src="https://tvax3.sinaimg.cn/large/bd728842gy1gkx84wcgxmj20fe08qdgc.jpg" alt=""><br>图3</p>
<p>综上，C点接收到的光强为：</p>
<script type="math/tex; mode=display">L = \int_{O}^{C}(\frac{L}{\left | PA \right |^{2}}\times \rho Mie\times IsInLight\times Iout\times IsInShadow)ds</script><p>由于\(IsInlight\)和\(IsInShadow\)是分段函数，因此上式积分不能写为解析形式，所以在实际计算中 会设置采样次数\(m\)，将\(OC\)直线离散为点，于是上式积分写为求和的形式：</p>
<script type="math/tex; mode=display">L = \sum_{i}^{m} {\frac{L}{\left | PiA \right |^{2}}}\times \rho Mie\times IsInLight\times Iout\times IsInShadow</script><h3 id="Unity实现"><a href="#Unity实现" class="headerlink" title="Unity实现"></a>Unity实现</h3><p><img src="https://tvax1.sinaimg.cn/large/bd728842gy1gkx7bmpmejj20xx0faarq.jpg" alt=""></p>
<h4 id="工程"><a href="#工程" class="headerlink" title="工程"></a>工程</h4><p><a href="https://github.com/zxpiano/volumetricLight" target="_blank" rel="noopener">体积光工程</a></p>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>[1]    <a href="https://software.intel.com/en-us/articles/ivb-atmospheric-light-scattering" target="_blank" rel="noopener">https://software.intel.com/en-us/articles/ivb-atmospheric-light-scattering</a></p>
<p>[2]    <a href="https://www.shadertoy.com/view/XlBSRz" target="_blank" rel="noopener">https://www.shadertoy.com/view/XlBSRz</a> </p>
<p>[3]    Real-Time Rendering Fourth Edition (589-616)</p>
<p>[4] <a href="https://zhuanlan.zhihu.com/p/21425792" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21425792</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/28/zTest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/28/zTest/" class="post-title-link" itemprop="url">zTest</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-28 21:19:26" itemprop="dateCreated datePublished" datetime="2020-03-28T21:19:26+08:00">2020-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-14 14:46:24" itemprop="dateModified" datetime="2020-11-14T14:46:24+08:00">2020-11-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><p><em>斜体字</em>，<strong>粗体字</strong>，<strong><em>加粗斜体字</em></strong>， <del>删除线</del></p>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>形式1：<a href="https://music.163.com/#/artist?id=12236203" target="_blank" rel="noopener">这是一个链接</a></p>
<p>形式2：<a href="https://space.bilibili.com/37146271/" target="_blank" rel="noopener">这也是一个链接</a>，<a href="https://github.com/zxpiano" target="_blank" rel="noopener">你猜会去哪？</a></p>
<p>形式3：这依然是一个链接<a href="https://github.com/zxpiano" target="_blank" rel="noopener">https://github.com/zxpiano</a></p>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><ul>
<li>无序列表1</li>
<li>无序列表2</li>
</ul>
<h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><ol>
<li>有序列表1</li>
<li>有序列表2</li>
</ol>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p><img src="/images/zTest/zTest.png" alt=""></p>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><div class="table-container">
<table>
<thead>
<tr>
<th>表头1</th>
<th style="text-align:left">表头2</th>
<th style="text-align:center">表头3</th>
<th style="text-align:right">表头4</th>
</tr>
</thead>
<tbody>
<tr>
<td>默认左对齐</td>
<td style="text-align:left">左对齐</td>
<td style="text-align:center">居中对齐</td>
<td style="text-align:right">右对齐</td>
</tr>
</tbody>
</table>
</div>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><blockquote>
<p>鲁迅曾经说过…</p>
</blockquote>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="单行"><a href="#单行" class="headerlink" title="单行"></a>单行</h3><pre><code>`hello world`
</code></pre><h3 id="多行"><a href="#多行" class="headerlink" title="多行"></a>多行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	previous, future</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><hr>
<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">start&#x3D;&gt;start: 开始</span><br><span class="line">input&#x3D;&gt;inputoutput: 输入</span><br><span class="line">operation&#x3D;&gt;operation: 操作</span><br><span class="line">condition&#x3D;&gt;condition: 操作出错？</span><br><span class="line">output&#x3D;&gt;inputoutput: 输出</span><br><span class="line">error&#x3D;&gt;operation: 请重新输入</span><br><span class="line">end&#x3D;&gt;end: 结束</span><br><span class="line"></span><br><span class="line">start-&gt;input</span><br><span class="line">input-&gt;operation</span><br><span class="line">operation-&gt;condition</span><br><span class="line">condition(no,bottom)-&gt;output</span><br><span class="line">condition(yes)-&gt;error(top)-&gt;input</span><br><span class="line">output-&gt;end</span><br></pre></td></tr></table></figure>
<h2 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h2><h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><p>行内添加：这是一个$y=x$.</p>
<p>单独一行居中添加： </p>
<script type="math/tex; mode=display">y=2 \times x</script><script type="math/tex; mode=display">\int_{\Omega}^{0} (x+1) dx</script><script type="math/tex; mode=display">f\left ( x \right )=\sum_{m}^{n} \oint_{\mathbb{P} }^{nil} {x_{a}}^{b} \sin y</script><h3 id="上下标"><a href="#上下标" class="headerlink" title="上下标"></a>上下标</h3><p>上标: $x^2$</p>
<p>下标: $x_1$</p>
<p>组合: <script type="math/tex">{16}_{8}O{2+}_{2}</script></p>
<h3 id="希腊字母"><a href="#希腊字母" class="headerlink" title="希腊字母"></a>希腊字母</h3><p>$\alpha ,\beta ,\gamma ,\delta ,\epsilon ,\varepsilon ,\zeta ,\eta ,\theta ,\vartheta ,\iota ,\kappa ,\lambda ,\mu ,\nu ,\xi ,\pi ,\varpi ,\rho ,\varrho ,\sigma ,\varsigma ,\tau ,\upsilon ,\phi ,\varphi ,\chi ,\psi ,\omega ,\Gamma ,\Delta ,\Theta ,\Lambda ,\Xi ,\Pi ,\Sigma ,\Upsilon, \Phi ,\Psi ,\Omega $</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/28/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZxPiano">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZxPiano">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/28/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-28 15:56:49" itemprop="dateCreated datePublished" datetime="2020-03-28T15:56:49+08:00">2020-03-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZxPiano</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zxpiano" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zxpiano" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zxpiano@qq.com" title="E-Mail → mailto:zxpiano@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/37146271" title="BiliBili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;37146271" rel="noopener" target="_blank"><i class="fa fa-fw fa-video-camera"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/artist?id=12236203" title="CloudMusic → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;artist?id&#x3D;12236203" rel="noopener" target="_blank"><i class="fa fa-fw fa-music"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZxPiano</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
